#!/bin/sh

PATH=/sbin:/usr/sbin:/bin:/usr/bin
DAEMON=/usr/bin/mosquitto_sub
NAME=mosquitto_sub
DESC="subscribe to topic frequency set"
BROKER="192.168.123.1"
PORT="1883"
TOPIC="appl/frequency_set"

test -x $DAEMON || exit 0

case "$1" in
  start)
    echo "Starting $DESC: $NAME"
    $DAEMON -d -h $BROKER -p $PORT -t $TOPIC   
    [$? = 0] && echo "$NAME started." || echo "$NAME failed to start." 
    ;;
  stop)
    echo "Stopping $DESC: $NAME"
    pkill -f $NAME
    [$? = 0] && echo "$NAME stopped." || echo "$NAME failed to stop."
    ;;
  restart|force-reload)
    echo "Restarting $DESC: $NAME"
    $0 stop
    sleep 1
    $0 start
    [$? = 0] && echo "$NAME restarted." || echo "$NAME failed to restart."
    ;;
  *)
    echo "Usage: /etc/init.d/$NAME {start|stop|restart|force-reload}"
    exit 1
    ;;
esac

exit 0
